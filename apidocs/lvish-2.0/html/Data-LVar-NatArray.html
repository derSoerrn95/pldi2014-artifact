<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Data.LVar.NatArray</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Data-LVar-NatArray.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">lvish-2.0: Parallel scheduler, LVar data structures, and infrastructure to build more.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Trustworthy</td></tr></table><p class="caption">Data.LVar.NatArray</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Basic operations
</a></li><li><a href="#g:2">Iteration and callbacks
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>An I-structure (array) of <em>positive</em> numbers.  A <code><a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a></code> cannot store zeros.
</p><p>This particular implementation makes a trade-off between expressiveness (monomorphic
in array contents) and efficiency.  The efficiency gained of course is that the array
may be unboxed, and we don't need extra bits to store empty/full status.
</p><p><em>However</em>, relative to <a href="Data-LVar-IStructure.html">Data.LVar.IStructure</a>, there is a performance disadvantage as
well.  As of [2013.09.28] and their initial release, <code><a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a></code>s are implemented as a
<em>single</em> <code><a href="Control-LVish-Internal.html#t:LVar">LVar</a></code>, which means they share a single wait-list of blocked computations.
If there are many computations blocking on different elements within a <code><a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a></code>,
scalability will be much worse than with other <code>IStructure</code> implementations.
</p><p>The holy grail is to get unboxed arrays and scalable blocking, but we don't have this
yet.
</p><p>Finally, note that this data-structure has an EXPERIMENTAL status and may be removed
in future releases as we find better ways to support unboxed array structures with
per-element synchronization.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:NatArray">NatArray</a> s a</li><li class="src short"><a href="#v:newNatArray">newNatArray</a> :: <span class="keyword">forall</span> elt e s. (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> elt, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> elt) =&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s (<a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s elt)</li><li class="src short"><a href="#v:put">put</a> :: <span class="keyword">forall</span> s e elt. (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> elt, <a href="file:///ffh/ryan/cloud_drive/working_copies/pldi2014-artifact/.cabal-sandbox/share/doc/x86_64-osx-ghc-7.6.3/bits-atomic-0.1.3/html/Data-Bits-Atomic.html#t:AtomicBits">AtomicBits</a> elt, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> elt, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> elt, HasPut e) =&gt; <a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s elt -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; elt -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ()</li><li class="src short"><a href="#v:get">get</a> :: <span class="keyword">forall</span> s e elt. (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> elt, <a href="file:///ffh/ryan/cloud_drive/working_copies/pldi2014-artifact/.cabal-sandbox/share/doc/x86_64-osx-ghc-7.6.3/bits-atomic-0.1.3/html/Data-Bits-Atomic.html#t:AtomicBits">AtomicBits</a> elt, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> elt, HasGet e) =&gt; <a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s elt -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s elt</li><li class="src short"><a href="#v:forEach">forEach</a> :: (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Eq.html#t:Eq">Eq</a> a) =&gt; <a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s a -&gt; (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; a -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ()) -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ()</li><li class="src short"><a href="#v:forEachHP">forEachHP</a> :: (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Eq.html#t:Eq">Eq</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> a) =&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-LVish.html#t:HandlerPool">HandlerPool</a> -&gt; <a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s a -&gt; (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; a -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ()) -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ()</li></ul></div><div id="interface"><h1 id="g:1">Basic operations
</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:NatArray" class="def">NatArray</a> s a </p><div class="doc"><p>An array of bit-fields with a monotonic OR operation.  This can be used to model
   a set of Ints by setting the vector entries to zero or one, but it can also
   model other finite lattices for each index.
 newtype NatArray s a = NatArray (LVar s (M.IOVector a) (Int,a))
</p></div></div><div class="top"><p class="src"><a name="v:newNatArray" class="def">newNatArray</a> :: <span class="keyword">forall</span> elt e s. (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> elt, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> elt) =&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s (<a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s elt)</p><div class="doc"><p>Physical identity, just as with IORefs.
 instance Eq (NatArray s v) where
   NatArray lv1 == NatArray lv2 = state lv1 == state lv2 
</p><p>Create a new, empty, monotonically growing <code><a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a></code> of a given size.
   All entries start off as zero, which must be BOTTOM.
</p></div></div><div class="top"><p class="src"><a name="v:put" class="def">put</a> :: <span class="keyword">forall</span> s e elt. (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> elt, <a href="file:///ffh/ryan/cloud_drive/working_copies/pldi2014-artifact/.cabal-sandbox/share/doc/x86_64-osx-ghc-7.6.3/bits-atomic-0.1.3/html/Data-Bits-Atomic.html#t:AtomicBits">AtomicBits</a> elt, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> elt, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> elt, HasPut e) =&gt; <a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s elt -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; elt -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ()</p><div class="doc"><p>Put a single element in the array.  That slot must be previously empty.  (WHNF)
 Strict in the element being put in the set.
</p></div></div><div class="top"><p class="src"><a name="v:get" class="def">get</a> :: <span class="keyword">forall</span> s e elt. (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> elt, <a href="file:///ffh/ryan/cloud_drive/working_copies/pldi2014-artifact/.cabal-sandbox/share/doc/x86_64-osx-ghc-7.6.3/bits-atomic-0.1.3/html/Data-Bits-Atomic.html#t:AtomicBits">AtomicBits</a> elt, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> elt, HasGet e) =&gt; <a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s elt -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s elt</p><div class="doc"><p>Wait for an indexed entry to contain a non-zero value.
</p><p>Warning: this is inefficient if it needs to block, because the deltaThresh must
 monitor EVERY new addition.
</p></div></div><h1 id="g:2">Iteration and callbacks
</h1><div class="top"><p class="src"><a name="v:forEach" class="def">forEach</a> :: (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Eq.html#t:Eq">Eq</a> a) =&gt; <a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s a -&gt; (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; a -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ()) -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ()</p><div class="doc"><p>Add an (asynchronous) callback that listens for all new elements added to
 the set
</p></div></div><div class="top"><p class="src"><a name="v:forEachHP" class="def">forEachHP</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Foreign-Storable.html#t:Storable">Storable</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Eq.html#t:Eq">Eq</a> a, <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Prelude.html#t:Num">Num</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-LVish.html#t:HandlerPool">HandlerPool</a></td><td class="doc"><p>pool to enroll in, if any
</p></td></tr><tr><td class="src">-&gt; <a href="Data-LVar-NatArray.html#t:NatArray">NatArray</a> s a</td><td class="doc"><p>array to listen to
</p></td></tr><tr><td class="src">-&gt; (<a href="file:///Library/Frameworks/GHC.framework/Versions/7.6.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.6.0.1/Data-Int.html#t:Int">Int</a> -&gt; a -&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ())</td><td class="doc"><p>callback
</p></td></tr><tr><td class="src">-&gt; <a href="Control-LVish-Internal.html#t:Par">Par</a> e s ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Add an (asynchronous) callback that listens for all new elements added to
 the array, optionally enrolled in a handler pool.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.13.2</p></div></body></html>